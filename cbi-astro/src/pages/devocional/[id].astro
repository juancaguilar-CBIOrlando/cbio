---
// src/pages/devocional/[id].astro
import Layout from "../../layouts/Layout.astro"
import ArrowRightIcon from "../../components/icons/ArrowRightIcon.astro"
import OpenBookIcon from "../../components/icons/OpenBookIcon.astro"
import { getDevotionalById } from "../../helpers/notion"

// Disable prerendering since we're fetching dynamic content from Notion
export const prerender = false;

const { id } = Astro.params;

// Get the devotional by ID
const devotional = await getDevotionalById(id);

// If devotional doesn't exist, redirect to 404 or list page
if (!devotional) {
  return Astro.redirect("/devocional");
}

const { title, content, explanation, verse, assets, date } = devotional;
---

<Layout title={title}>
  <div class="container mx-auto px-4 py-8">
    <article class="max-w-3xl mx-auto">
      <!-- Back Button -->
      <div class="mb-6">
        <a 
          href="/devocional" 
          class="inline-flex items-center text-blue-800 hover:text-blue-600 transition-colors"
        >
          <ArrowRightIcon size={16} class="mr-2 rotate-180" />
          Volver a Devocionales
        </a>
      </div>

      <!-- Header -->
      <header class="mb-8">
        <div class="flex items-center gap-4 mb-4">
          <div class="bg-blue-800 rounded-full p-4">
            <OpenBookIcon size={28} color="white" />
          </div>
          <h1 class="text-3xl font-bold text-gray-900" set:html={title} />
        </div>
        <p class="text-gray-500 capitalize">
          {new Date(date).toLocaleDateString('es-ES', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
        </p>
      </header>

      <div class="flex flex-col gap-y-2">
        <!-- Verse -->
        {verse && (
          <>
            <div class="prose prose-lg font-bold capitalize" set:html={verse} />
            <br />
          </>
        )}
        
        <!-- Content -->
        {content && (
          <div class="prose prose-lg" set:html={content} />
        )}

        <!-- Explanation -->
        {explanation && (
          <div class="prose prose-lg mt-2">
            <p class="text-gray-700 capitalize">Estimado lector:</p>
            <div class="prose prose-lg" set:html={explanation} />
          </div>
        )}
      </div>

      <!-- Assets -->
      {assets && (
        <div class="mt-8">
          <img src={assets} alt={title} class="w-full rounded-lg" />
        </div>
      )}

      <!-- Navigation -->
      <div class="mt-12 flex justify-between items-center border-t pt-6">
        <a 
          href="/devocional" 
          class="inline-flex items-center text-blue-800 hover:text-blue-600 transition-colors"
        >
          <ArrowRightIcon size={16} class="mr-2 rotate-180" />
          Ver todos los devocionales
        </a>
      </div>
    </article>
  </div>
</Layout>

