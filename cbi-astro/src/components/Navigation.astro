---
import { MenuIcon, XIcon } from "lucide-react";

const { logo = 'black' } = Astro.props;
const routes = [
  { name: 'Inicio', path: '/' },
  { name: 'Nosotros', path: '/nosotros' },
  { name: 'Devocional', path: '/devocional' },
  { name: 'CBI Kids', path: '/kids' },
  { name: 'Valores', path: '/valores' },
  // { name: 'Galeria', path: '/galeria' },
  { name: 'Dar', path: '/donation' },
  { name: 'Conectate', path: '/conectate' },
];
---

<nav class="fixed top-0 left-0 w-full z-50 bg-transparent px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between" data-preferred-logo={logo}>
  <div class="w-full flex items-center justify-between">
    <!-- Brand / Logo -->
    <a href="/" class="inline-flex items-center pt-4 relative h-16">
      <img data-logo="white" src="/mainlogoWhite.png" alt="CBI Orlando" class="absolute inset-0 h-20 w-auto transition-opacity duration-300 opacity-0 pt-1" />
      <img data-logo="black" src="/mainLogoBlack.png" alt="CBI Orlando" class="h-18 w-auto transition-opacity duration-300 opacity-0" />
    </a>

    <!-- Desktop menu (show from large screens and up so tablets use mobile nav) -->
    <div class="hidden lg:flex lg:items-center lg:space-x-4">
      {routes.map((route) => (
        <a
          href={route.path}
          class={`inline-flex items-center font-bold px-4 py-2 transition-all duration-300 ${
            route.name === 'Conectate'
              ? 'text-[#b81516] border-2 border-[#b81516] rounded-md hover:bg-[#b81516] hover:text-white'
              : 'hover:text-gray-700'
          }`}
        >
          {route.name}
        </a>
      ))}
    </div>

    <!-- Mobile menu button -->
    <button
      class="lg:hidden p-4 pr-2 rounded-md cursor-pointer"
      aria-label="Toggle menu"
      id="mobile-menu-button"
    >
      <MenuIcon id="mobile-menu-icon" color="white" size={26} />
    </button>
  </div>

  <!-- Mobile menu OPENED STATE -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-50 hidden bg-white transform transition-all duration-300 ease-in-out -translate-x-full"
  >
    <div class="flex flex-col h-full">
      <div class="flex justify-end p-4">
        <button
          class="p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#b81516]"
          aria-label="Close menu"
          id="close-menu-button"
        >
          <XIcon color="black" />
        </button>
      </div>
      <div class="flex flex-col items-center space-y-4 p-4">
        {routes.map((route) => (
          <a
            href={route.path}
            class={`w-full text-center font-bold px-4 py-2 transition-all duration-300 ${
              route.name === 'Conectate'
                ? 'text-[#b81516] border-2 border-[#b81516] rounded-md hover:bg-[#b81516] hover:text-white'
                : 'hover:text-gray-700'
            }`}
          >
            {route.name}
          </a>
        ))}
      </div>
    </div>
  </div>
</nav>

<script>
  // @ts-nocheck
  // Logo crossfade logic (white over hero, black after scrolling)
  const navEl = document.querySelector('nav[data-preferred-logo]');
  const preferredLogo = navEl?.getAttribute('data-preferred-logo') || 'black';
  const whiteLogo = document.querySelector('img[data-logo="white"]');
  const blackLogo = document.querySelector('img[data-logo="black"]');

  function setLogo(color) {
    if (!whiteLogo || !blackLogo) return;
    if (color === 'white') {
      whiteLogo.classList.remove('opacity-0');
      whiteLogo.classList.add('opacity-100');
      blackLogo.classList.remove('opacity-100');
      blackLogo.classList.add('opacity-0');
    } else {
      whiteLogo.classList.remove('opacity-100');
      whiteLogo.classList.add('opacity-0');
      blackLogo.classList.remove('opacity-0');
      blackLogo.classList.add('opacity-100');
    }
  }

  function setMenuIconColor(color) {
    const menuIcon = document.getElementById('mobile-menu-icon');
    if (!menuIcon) return;
    // lucide-react icons render as SVG, change stroke color of all paths
    const paths = menuIcon.querySelectorAll('path');
    paths.forEach((path) => {
      path.setAttribute('stroke', color);
    });
  }

  // Initial state uses the server-provided preference
  const initialColor = preferredLogo === 'white' ? 'white' : 'black';
  setLogo(initialColor);
  setMenuIconColor(initialColor);

  // If a hero is present, auto-toggle based on its visibility
  const hero = document.querySelector('[data-hero]');
  if (hero) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // While hero is in view, show white logo and icon
            setLogo('white');
            setMenuIconColor('white');
          } else {
            // After scrolling past hero, show black logo and icon
            setLogo('black');
            setMenuIconColor('black');
          }
        });
      },
      {
        root: null,
        threshold: 0.1, // toggle a bit before fully leaving/entering
      }
    );
    observer.observe(hero);
  }

  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const closeMenuButton = document.getElementById('close-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.remove('hidden');
    // Force a reflow to ensure the animation starts from the correct position
    mobileMenu?.offsetHeight;
    mobileMenu?.classList.remove('-translate-x-full');
  });

  closeMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.add('-translate-x-full');
    setTimeout(() => {
      mobileMenu?.classList.add('hidden');
    }, 300);
  });
</script> 