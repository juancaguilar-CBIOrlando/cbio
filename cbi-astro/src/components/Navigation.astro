---
import { MenuIcon, XIcon, ChevronDownIcon } from "lucide-react";


// Route type definitions
type Route = {
  name: string;
  path?: string;
  children?: { name: string; path: string }[];
};

const routes: Route[] = [
  { name: 'Inicio', path: '/' },
  { name: 'CBI Kids', path: '/kids' },
  { name: 'Devocional', path: '/devocional' },
  { name: 'Nosotros', path: '/nosotros' },
  { 
    name: 'Next Steps', 
    children: [
      { name: 'Conectate', path: '/conectate' },
      { name: 'Bautizos', path: '/conectate#bautizos' },
      { name: 'Clases de Conexión', path: '/conectate#conexion' },
      { name: 'El Dream Team', path: '/conectate#dream-team' },
      { name: 'Grupos Pequeños', path: '/conectate#grupos' },
    ]
  },
];
---

<nav class="absolute top-0 left-0 w-full z-50 bg-transparent px-4 sm:px-6 lg:px-8 lg:py-10 h-16 flex items-center justify-between">
  <div class="w-full flex items-center justify-between">
    <!-- Brand / Logo -->
    <a href="/" class="inline-flex items-center h-16 mt-4 lg:mt-0">
      <img src="/mainlogoWhite.png" alt="CBI Orlando" class="h-18 w-auto" />
    </a>

    <!-- Desktop menu (show from large screens and up so tablets use mobile nav) -->
    <div class="hidden lg:flex lg:items-center lg:space-x-4">
      {routes.map((route) => (
        route.children ? (
          <!-- Desktop Dropdown -->
          <div class="relative" data-dropdown>
            <button
              class="inline-flex items-center gap-1 font-bold px-4 py-2 text-white transition-all duration-300 hover:text-white/80 cursor-pointer"
              data-dropdown-trigger
            >
              {route.name}
              <ChevronDownIcon 
                size={18} 
                color="white"
                className="transition-transform duration-300" 
                data-dropdown-icon
              />
            </button>
            <div 
              class="absolute top-full left-0 mt-2 w-56 bg-primary rounded-lg shadow-xl opacity-0 invisible transform -translate-y-2 transition-all duration-300 overflow-hidden"
              data-dropdown-panel
            >
              <div class="py-2">
                {route.children.map((child) => (
                  <a
                    href={child.path}
                    class="block px-4 py-3 text-white font-medium hover:bg-white/20 transition-colors duration-200"
                  >
                    {child.name}
                  </a>
                ))}
              </div>
            </div>
          </div>
        ) : (
          <a
            href={route.path}
            class="inline-flex items-center font-bold px-4 py-2 text-white transition-all duration-300 hover:text-gray-700"
          >
            {route.name}
          </a>
        )
      ))}
    </div>

    <!-- Mobile menu button -->
    <button
      class="lg:hidden p-4 pr-2 rounded-md cursor-pointer"
      aria-label="Toggle menu"
      id="mobile-menu-button"
    >
      <MenuIcon id="mobile-menu-icon" color="white" size={26} />
    </button>
  </div>

  <!-- Mobile menu OPENED STATE -->
  <div
    id="mobile-menu"
    class="fixed inset-0 z-50 hidden bg-white transform transition-all duration-300 ease-in-out -translate-x-full"
  >
    <div class="flex flex-col h-full">
      <div class="flex justify-end p-4">
        <button
          class="p-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#b81516]"
          aria-label="Close menu"
          id="close-menu-button"
        >
          <XIcon color="black" />
        </button>
      </div>
      <div class="flex flex-col items-center space-y-4 p-4">
        {routes.map((route) => (
          route.children ? (
            <!-- Mobile Accordion -->
            <div class="w-full" data-accordion>
              <button
                class="w-full flex items-center justify-center font-bold px-4 py-2 transition-all duration-300 hover:text-gray-700 cursor-pointer relative"
                data-accordion-trigger
              >
                <span>{route.name}</span>
                <div class="absolute right-4 w-8 h-8 rounded-full bg-primary flex items-center justify-center transition-all duration-300" data-accordion-icon-wrapper>
                  <ChevronDownIcon 
                    size={20} 
                    color="white"
                    className="transition-transform duration-300" 
                    data-accordion-icon
                  />
                </div>
              </button>
              <div 
                class="overflow-hidden transition-all duration-300 ease-in-out"
                style="max-height: 0;"
                data-accordion-panel
              >
                <div class="pb-2 space-y-1">
                  {route.children.map((child) => (
                    <a
                      href={child.path}
                      class="block text-center font-semibold text-base py-3 px-2 hover:text-gray-700 transition-colors duration-200"
                    >
                      {child.name}
                    </a>
                  ))}
                </div>
              </div>
            </div>
          ) : (
            <a
              href={route.path}
              class={`w-full text-center font-bold px-4 py-2 transition-all duration-300 ${
                route.name === 'Conectate'
                  ? 'text-[#b81516] border-2 border-[#b81516] rounded-md hover:bg-[#b81516] hover:text-white'
                  : 'hover:text-gray-700'
              }`}
            >
              {route.name}
            </a>
          )
        ))}
      </div>
    </div>
  </div>
</nav>

<script>
  // @ts-nocheck
  // Mobile menu open/close
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const closeMenuButton = document.getElementById('close-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.remove('hidden');
    mobileMenu?.offsetHeight;
    mobileMenu?.classList.remove('-translate-x-full');
  });

  closeMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.add('-translate-x-full');
    setTimeout(() => {
      mobileMenu?.classList.add('hidden');
    }, 300);
  });

  // Desktop Dropdown Logic (hover-based)
  const dropdowns = document.querySelectorAll('[data-dropdown]');
  
  dropdowns.forEach((dropdown) => {
    const panel = dropdown.querySelector('[data-dropdown-panel]');
    const icon = dropdown.querySelector('[data-dropdown-icon]');
    
    if (!panel || !icon) return;
    
    function openDropdown() {
      panel.classList.remove('opacity-0', 'invisible', '-translate-y-2');
      panel.classList.add('opacity-100', 'visible', 'translate-y-0');
      icon.style.transform = 'rotate(180deg)';
    }
    
    function closeDropdown() {
      panel.classList.add('opacity-0', 'invisible', '-translate-y-2');
      panel.classList.remove('opacity-100', 'visible', 'translate-y-0');
      icon.style.transform = 'rotate(0deg)';
    }
    
    // Open on hover
    dropdown.addEventListener('mouseenter', () => {
      openDropdown();
    });
    
    // Close when mouse leaves
    dropdown.addEventListener('mouseleave', () => {
      closeDropdown();
    });
  });

  // Mobile Accordion Logic
  const accordions = document.querySelectorAll('[data-accordion]');
  
  accordions.forEach((accordion) => {
    const trigger = accordion.querySelector('[data-accordion-trigger]');
    const panel = accordion.querySelector('[data-accordion-panel]');
    const icon = accordion.querySelector('[data-accordion-icon]');
    const iconWrapper = accordion.querySelector('[data-accordion-icon-wrapper]');
    
    if (!trigger || !panel || !icon) return;
    
    let isOpen = false;
    
    trigger.addEventListener('click', () => {
      isOpen = !isOpen;
      
      if (isOpen) {
        // Calculate the actual height of the content
        panel.style.maxHeight = panel.scrollHeight + 'px';
        icon.style.transform = 'rotate(180deg)';
      } else {
        panel.style.maxHeight = '0';
        icon.style.transform = 'rotate(0deg)';
      }
    });
  });
</script>

<style>
  /* CBI Kids animated gradient border */
  .kids-link-animated {
    position: relative;
    background: white;
    z-index: 1;
  }

  .kids-link-animated::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 9999px;
    background: linear-gradient(90deg, #FF6B6B, #FFD93D, #6BCB77, #45B7D1, #FF6B6B);
    background-size: 300% 100%;
    animation: gradient-flow 3s ease infinite;
    z-index: -1;
  }

  /* Mobile version with dark background context */
  .kids-link-animated-mobile {
    position: relative;
    background: white;
    z-index: 1;
  }

  .kids-link-animated-mobile::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 9999px;
    background: linear-gradient(90deg, #FF6B6B, #FFD93D, #6BCB77, #45B7D1, #FF6B6B);
    background-size: 300% 100%;
    animation: gradient-flow 3s ease infinite;
    z-index: -1;
  }

  @keyframes gradient-flow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
</style>
