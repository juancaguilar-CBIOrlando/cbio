---
import "swiper/css"
import "swiper/css/navigation"
import "swiper/css/autoplay"
import { Image } from "astro:assets"
import ActionButton from "./common/ActionButton.astro"
import SliderArrow from "./common/SliderArrow.astro"
import { address } from "../constants"
// Import optimized images from assets
import heroVideoUrl from "../assets/heroVideo.mov"
import serviciosDominicalImg from "../assets/serviciosDominical.jpeg"

type Slide = {
  id: number
  image: ImageMetadata | null
  videoUrl?: string | null
  title: string
  description: string | null
  cta: { text: string; link: string; color: string; isExternal?: boolean }[]
}

const slides: Slide[] = [
  {
    id: 1,
    image: null,
    videoUrl: heroVideoUrl,
    title: "AMAR A DIOS| AMAR LA FAMILIA | AMAR EL SERVICIO.",
    description: null,
    cta: [
      {
        text: "Soy Nuevo",
        link: "/conectate",
        color: "#3498db",
      },
      {
        text: "Como Llegar",
        link: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`,
        color: "#3498db",
        isExternal: true,
      },
    ],
  },
  {
    id: 2,
    image: null, // TODO: Add a third slide image
    videoUrl: null,
    title: "Unete a Nuestros Grupos de Conexión",
    description: "Todos los Viernes a las 7:00 PM",
    cta: [
      {
        text: "Conéctate",
        link: "/conectate",
        color: "#2ecc71",
      },
    ],
  },
  {
    id: 3,
    image: serviciosDominicalImg,
    title: "Servicios Dominicales",
    description: "Todos los domingos a las 9:30 AM y 11:30 AM",
    cta: [
      {
        text: "Ver horarios",
        link: "/servicios",
        color: "#2ecc71",
      },
    ],
  },
]
---

<div class="relative w-full" data-hero>
  <div class="hero-swiper w-full h-screen overflow-hidden">
    <div class="swiper-wrapper">
      {
        slides.map((slide) => (
          <div class="swiper-slide relative">
            {/* FIXME: GET ACTUAL IMAGE AND VIDEO STORAGE SETUP */}
            {slide.image ? (
              <Image
                src={slide.image}
                alt={slide.title}
                width={1920}
                height={1080}
                quality={75}
                class="w-full h-full object-cover"
                loading={slide.id === 1 ? "eager" : "lazy"}
              />
            ) : slide.videoUrl ? (
              <video
                src={slide.videoUrl}
                class="w-full h-full object-cover pointer-events-none"
                autoplay
                muted
                loop
                playsinline
                preload="auto"
                tabindex="-1"
                disableRemotePlayback
                disablepictureinpicture
              />
            ) : (
              <div class="w-full h-full bg-linear-to-br from-[#161E57] to-[#0d1235]" />
            )}
            <div class="absolute inset-0 z-10 pointer-events-none bg-linear-to-t from-black/90 via-black/60 to-transparent" />
            <div class="absolute inset-0 z-20 flex flex-col items-center justify-center text-white p-4 text-center gap-y-2 mt-24 w-full">
              <div class="flex flex-col items-center justify-center mb-2 pt-28">
                <h1 class="text-4xl md:text-5xl font-bold w-full">
                  {slide.title}
                </h1>
                {slide.description && (
                  <p class="text-xl md:text-2xl">{slide.description}</p>
                )}
              </div>

              <div class="flex flex-col sm:flex-row gap-4 items-center justify-center w-3/5 max-w-[400px]">
                {slide.cta.map((cta) => (
                  <ActionButton
                    text={cta.text}
                    link={cta.link}
                    color={cta.color}
                    isExternal={cta.isExternal}
                  />
                ))}
              </div>
            </div>
          </div>
        ))
      }
    </div>
    <div
      class="absolute bottom-4 sm:bottom-8 left-[50%] translate-x-[-50%] flex justify-between gap-4 max-h-4 items-center z-30">
      <SliderArrow direction="prev" class="hero-swiper-prev" />
      <SliderArrow
        direction="next"
        class="hero-swiper-next w-6 h-6 border-2 border-primary"
      />
    </div>
  </div>
</div>

<script>
  import Swiper from "swiper"
  import { Autoplay, Navigation } from "swiper/modules"

  document.addEventListener("DOMContentLoaded", () => {
    new Swiper(".hero-swiper", {
      modules: [Autoplay, Navigation],
      autoplay: {
        delay: 9300,
        // disableOnInteraction: false,
      },
      navigation: {
        prevEl: ".hero-swiper-prev",
        nextEl: ".hero-swiper-next",
      },
    })
  })
</script>
