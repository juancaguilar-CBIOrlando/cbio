---
import { Image } from "astro:assets"
import type { ImageMetadata } from "astro"
import { Calendar1, MapPin, Clock } from "@lucide/astro"
import SliderArrow from "../common/SliderArrow.astro"
import "swiper/css"
import "swiper/css/navigation"

// Import placeholder images - replace with actual event images
import placeholderImg1 from "../../assets/images/hero.jpg"

type UpcomingEvent = {
    id: number
    title: string
    category: string
    date: string
    time: string
    location: string
    image: string | ImageMetadata
    featured?: boolean
}

// Sample data - replace with actual data source (CMS, API, etc.)
const upcomingEvents: UpcomingEvent[] = [
    {
        id: 1,
        title: "Noche de Vijilia",
        category: "Adoración",
        date: "23 Enero, 2026",
        time: "7:30 PM",
        location: "CBI Orlando",
        image: "https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?auto=format&fit=crop&w=800&q=80",
        featured: true,
    },
    {
        id: 2,
        title: "Noche de Parejas",
        category: "Jóvenes",
        date: "14 Febrero, 2026",
        time: "7:00 PM",
        location: "CBI Orlando",
        image: "https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=800&q=80",
    },
    {
        id: 4,
        title: "Brunch de Mujeres",
        category: "Mujeres",
        date: "14 Febrero, 2026",
        time: "9:00 AM",
        location: "Centro de Retiros",
        image: "https://images.unsplash.com/photo-1523580494863-6f3031224c94?auto=format&fit=crop&w=800&q=80",
        featured: true,
    },
    {
        id: 5,
        title: "Servicio Especial de Sanidad",
        category: "Especial",
        date: "21 Febrero, 2026",
        time: "7:00 PM",
        location: "Templo Principal",
        image: "https://images.unsplash.com/photo-1544027993-37dbfe43562a?auto=format&fit=crop&w=800&q=80",
    },
]
---

<section class="py-12 sm:py-20 px-4 sm:px-6 lg:px-16 text-white">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div
            class="flex items-center sm:items-center justify-between gap-6 mb-4">
            <div>
                <h2
                    class="inline-block text-primary text-md font-semibold uppercase tracking-[3px] mb-2">
                    Próximos Eventos
                </h2>
            </div>
        </div>

        <!-- Slider Container -->
        <div class="upcoming-events-container relative">
            <div class="swiper upcoming-events-swiper">
                <div class="swiper-wrapper">
                    {
                        upcomingEvents.map((event, index) => {
                            const isLocalImage = typeof event.image !== "string"
                            return (
                                <div class="swiper-slide">
                                    <article class="event-slide-card group relative bg-white rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-1 h-full">
                                        {/* Image Container */}
                                        <div class="relative h-52 sm:h-56 overflow-hidden">
                                            {isLocalImage ? (
                                                <Image
                                                    src={
                                                        event.image as ImageMetadata
                                                    }
                                                    alt={event.title}
                                                    width={600}
                                                    height={400}
                                                    format="webp"
                                                    quality={80}
                                                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                                    loading="lazy"
                                                />
                                            ) : (
                                                <img
                                                    src={event.image as string}
                                                    alt={event.title}
                                                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                                    loading="lazy"
                                                />
                                            )}

                                            {/* Gradient Overlay */}
                                            <div class="absolute inset-0 bg-linear-to-t from-accent/90 via-accent/40 to-transparent" />

                                            {/* Category Badge */}
                                            <div class="absolute top-4 left-4">
                                                <span class="inline-block bg-primary text-white text-xs font-bold px-3 py-1.5 rounded-full uppercase tracking-wider shadow-lg">
                                                    {event.category}
                                                </span>
                                            </div>

                                            {/* Date on Image */}
                                            <div class="absolute bottom-4 left-4 right-4">
                                                <div class="flex items-center gap-2 text-white">
                                                    <Calendar1 class="w-4 h-4 text-primary" />
                                                    <span class="text-sm font-semibold">
                                                        {event.date}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Content */}
                                        <div class="p-6">
                                            <h3 class="text-xl sm:text-2xl font-bold font-bebas tracking-wide text-accent mb-4 group-hover:text-primary transition-colors duration-300 line-clamp-2">
                                                {event.title}
                                            </h3>

                                            {/* Meta Info */}
                                            <div class="space-y-2 mb-5">
                                                <div class="flex items-center gap-2 text-gray-600">
                                                    <Clock class="w-4 h-4 text-primary/70" />
                                                    <span class="text-sm">
                                                        {event.time}
                                                    </span>
                                                </div>
                                                <div class="flex items-center gap-2 text-gray-600">
                                                    <MapPin class="w-4 h-4 text-primary/70" />
                                                    <span class="text-sm">
                                                        {event.location}
                                                    </span>
                                                </div>
                                            </div>

                                            {/* CTA */}
                                            {/* <a
                                                href={`/eventos/${event.id}`}
                                                class="inline-flex items-center gap-2 text-primary font-semibold text-sm group/link hover:gap-3 transition-all duration-300">
                                                Más información
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    class="w-4 h-4 transition-transform duration-300 group-hover/link:translate-x-1"
                                                    fill="none"
                                                    viewBox="0 0 24 24"
                                                    stroke="currentColor"
                                                    stroke-width="2">
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        d="M17 8l4 4m0 0l-4 4m4-4H3"
                                                    />
                                                </svg>
                                            </a> */}
                                        </div>

                                        {/* Decorative Elements */}
                                        <div class="absolute top-0 right-0 w-24 h-24 bg-primary/5 rounded-bl-[3rem] opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                                        <div class="absolute bottom-0 left-0 w-16 h-16 bg-accent/5 rounded-tr-[2rem] opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                                    </article>
                                </div>
                            )
                        })
                    }
                </div>
            </div>
        </div>

        {/* View All Link */}
        <div class="mt-12 text-center">
            <a
                href="/eventos"
                class="inline-flex items-center gap-3 bg-accent hover:bg-accent/90 text-white font-semibold px-8 py-4 rounded-full transition-all duration-300 hover:shadow-xl hover:-translate-y-0.5 group">
                Ver todos los eventos
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 transition-transform duration-300 group-hover:translate-x-1"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                </svg>
            </a>
        </div>
    </div>
</section>

<script>
    import Swiper from "swiper"
    import { Navigation, Autoplay } from "swiper/modules"

    function initUpcomingEventsSwiper() {
        new Swiper(".upcoming-events-swiper", {
            modules: [Navigation, Autoplay],
            slidesPerView: 1.1,
            spaceBetween: 20,
            grabCursor: true,
            autoplay: {
                delay: 5000,
                disableOnInteraction: true,
                pauseOnMouseEnter: true,
            },
            navigation: {
                prevEl: ".upcoming-events-prev",
                nextEl: ".upcoming-events-next",
            },
            breakpoints: {
                480: {
                    slidesPerView: 1.3,
                    spaceBetween: 20,
                },
                640: {
                    slidesPerView: 2,
                    spaceBetween: 24,
                },
                1024: {
                    slidesPerView: 3,
                    spaceBetween: 28,
                },
                1280: {
                    slidesPerView: 3.2,
                    spaceBetween: 32,
                },
            },
        })
    }

    // Initialize on DOM ready
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initUpcomingEventsSwiper)
    } else {
        initUpcomingEventsSwiper()
    }
</script>

<style>
    .upcoming-events-container {
        position: relative;
    }

    .upcoming-events-swiper {
        overflow: hidden;
        padding-bottom: 4px; /* Space for shadow */
    }

    .upcoming-events-swiper .swiper-slide {
        height: auto;
    }

    .event-slide-card {
        opacity: 0;
        animation: slide-fade-in 0.6s ease-out forwards;
    }

    @keyframes slide-fade-in {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
