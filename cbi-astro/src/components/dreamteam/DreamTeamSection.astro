---
import { Image } from "astro:assets"
import SliderArrow from "../common/SliderArrow.astro"
import "swiper/css"
import "swiper/css/navigation"

type Slide = {
  id: string
  title: string
  description: string
  image: ImageMetadata
}

interface Props {
  eyebrow?: string
  title: string
  description?: string
  ctaText?: string
  ctaHref?: string
  sliderName: string
  slides: Slide[]
  reversed?: boolean
}

const {
  eyebrow,
  title,
  description,
  ctaText,
  ctaHref,
  sliderName,
  slides,
  reversed = false,
} = Astro.props
---

<section class="py-16 lg:py-24 px-6 lg:px-16">
  <div
    class:list={[
      "dreamteam-section max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 items-center",
      { "lg:flex-row-reverse": reversed },
    ]}>
    <!-- Text Content -->
    <div class:list={["pt-2", { "lg:order-2": reversed }]}>
      {
        eyebrow && (
          <span class="inline-block bg-primary/10 text-primary px-4 py-1 rounded-full text-sm font-semibold uppercase tracking-wide mb-4">
            {eyebrow}
          </span>
        )
      }

      <h2
        class="font-bebas text-4xl sm:text-5xl lg:text-6xl leading-[0.95] text-accent">
        {title}
      </h2>

      {
        description && (
          <p class="mt-5 text-gray-600 text-lg leading-relaxed max-w-prose">
            {description}
          </p>
        )
      }

      {
        ctaText && ctaHref && (
          <a
            href={ctaHref}
            class="inline-flex items-center gap-2 mt-8 bg-primary text-white px-8 py-3 rounded-full font-semibold hover:bg-primary/90 transition-colors group">
            {ctaText}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="transform group-hover:translate-x-1 transition-transform duration-300">
              <path d="M5 12h14" />
              <path d="m12 5 7 7-7 7" />
            </svg>
          </a>
        )
      }
    </div>

    <!-- Slider -->
    <div class:list={["dreamteam-slider w-full", { "lg:order-1": reversed }]}>
      <div
        class:list={[
          "flex items-center gap-3 mb-4",
          reversed ? "lg:justify-start" : "justify-end",
        ]}>
        <SliderArrow
          direction="prev"
          class={`${sliderName}-swiper-prev`}
          ariaLabel="Anterior"
        />
        <SliderArrow
          direction="next"
          class={`${sliderName}-swiper-next`}
          ariaLabel="Siguiente"
        />
      </div>

      <div class={`${sliderName}-swiper-container relative`}>
        <div
          class={`swiper ${sliderName}-swiper`}
          data-slider-name={sliderName}
          data-prev-btn={`.${sliderName}-swiper-prev`}
          data-next-btn={`.${sliderName}-swiper-next`}>
          <div class="swiper-wrapper">
            {
              slides.map((slide) => (
                <div class="swiper-slide">
                  <article class="slide-card rounded-3xl overflow-hidden bg-black/5 h-full">
                    <div class="relative aspect-4/5">
                      <Image
                        src={slide.image}
                        alt={slide.title}
                        width={800}
                        height={1000}
                        quality={80}
                        class="w-full h-full object-cover"
                        loading="lazy"
                      />
                      <div class="absolute inset-0 bg-linear-to-t from-black/80 via-black/40 to-transparent" />
                      <div class="absolute bottom-0 left-0 right-0 p-6">
                        <h3 class="text-white font-bold text-xl mb-2">
                          {slide.title}
                        </h3>
                        <p class="text-white/80 text-sm leading-relaxed line-clamp-3">
                          {slide.description}
                        </p>
                      </div>
                    </div>
                  </article>
                </div>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // @ts-nocheck
  import Swiper from "swiper"
  import { Navigation } from "swiper/modules"

  function initDreamTeamSwipers() {
    const swiperElements = /** @type {NodeListOf<HTMLElement>} */ (
      document.querySelectorAll(".dreamteam-slider .swiper")
    )

    swiperElements.forEach((swiperEl) => {
      const prevBtn = swiperEl.getAttribute("data-prev-btn")
      const nextBtn = swiperEl.getAttribute("data-next-btn")
      const sliderName = swiperEl.getAttribute("data-slider-name")

      if (prevBtn && nextBtn) {
        new Swiper(/** @type {HTMLElement} */ (swiperEl), {
          modules: [Navigation],
          slidesPerView: 1.15,
          spaceBetween: 18,
          navigation: {
            prevEl: prevBtn,
            nextEl: nextBtn,
          },
          breakpoints: {
            640: { slidesPerView: 1.3, spaceBetween: 20 },
            768: { slidesPerView: 1.5, spaceBetween: 22 },
            1024: { slidesPerView: 1.2, spaceBetween: 24 },
          },
        })
      }
    })
  }

  // Initialize on DOM ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initDreamTeamSwipers)
  } else {
    initDreamTeamSwipers()
  }
</script>

<style>
  .dreamteam-slider {
    width: 100%;
  }

  .dreamteam-slider .swiper {
    overflow: hidden;
    width: 100%;
  }

  .dreamteam-slider .swiper-slide {
    height: auto;
  }

  .dreamteam-slider .slide-card {
    width: 100%;
  }
</style>
